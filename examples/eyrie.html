<html>
<head>
  <meta charset="UTF-8"></meta>
  <title>Eyrie</title>
  <style>
    // Most IoT lights support some sort of hardware dimming. This sets the
    // interval to 1 second by default, for devices that support such animation.
    light {
      animation-duration: 1;
    }

    // Define classes for light styles we use below.
    .off {
      // Visibility 'visible' lights are switched on, whereas 'hidden' lights
      // are switched off.
      visibility: hidden;
      // OpenHouse supports #rgb, #rrggbb, rgb(u8,u8,u8), as one would expect.
      // It also support more specific modes like mired(N) to set a specific
      // color-temperature on supporting bulbs as well as brightness-hue-
      // saturation, bhs(u8,u16,u8).
      color: bhs(0, 47000, 255);
    }
    .low {
      visibility: visible;
      color: bhs(64, 34495, 232);
    }
    .moonlight {
      visibility: visible;
      color: bhs(0, 47000, 255);
    }
    .daylight {
      visibility: visible;
      color: bhs(255, 34495, 232);
    }
  </style>
</head>

<!-- The top-level layout element of the Home Text Markup Language is the "home". -->
<home name="eyrie" scene="on" w="24ft" l="32ft6in">
  <!-- This comment block describes in a more graphical form the layout elements that follow. -->
  <comment>
    Horizontal: 4 '-' per ft
    Vert: 2 '|' per ft
    Reference is upper-left corner.
    X is left-to-right.
    Y is top-to-bottom.
    Z is floor-to-ceiling.

    ---------------------------------------------------------------------------------------------------+
    |                                        |        .            *                                   |
    |                                        |        .                                                |
    |                                        |        .                                                |
    |                                        |        .                                                |
    |                                        |        .                                                |
    |                                        |        .                                                |
    |                                        |        .                                                |
    |                                        |        .                                                |
    |         Office                         |        .                 Bedroom                        |
    |            10ftx13ft                   |________.                    12ftx10ft                   |
    |                 (+2ft for closet)      .        |                       (+2ft for closet)        |
    |                                        .        |                                                |
    |                                        .        |                                                |
    |                                        .        |                                                |
    |                                        .        |                                                |
    |                                        .        |                                                |
    |                                        .        |                                                |
    |                                        .        |                                                |
    |                                        +________+@@@@@@@@@@--------------------------------------+
    |                                        @                         @                               |
    |                                        @        Hall             @                               |
    |                                        @          7' x 6'        @                               |
    |                                        @                         @                               |
    |@@@@@@-------------------------------------------+          +-----+        Bathroom               |
    @                                                 @          @     |                               |
    @                                                 @          @     |                               |
    @  Entry                                          @          @     |                               |
    @    42" x 42"                                    @          @     |                               |
    @                                                 @          @     |                               |
    +--------------                                   +@@@@@@@@@@+-----+-------------------------------+
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |          Kitchen                               |
    |                                                 |             12'x8'                             |
    |     Living Room                                 |                                                |
    |        13' x 19'9"                              |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 +----------------@@@@@@@@@@@@---+@@@@@@@@@@------+
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                      Dining Room                |   Utility      |
    |                                                         7'6"x8'6"               |     4'6"x8'6"  |
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                                                 |                |
    +-------------------------------------@@@@@@@@@@@@--------------------------------+----------------+
  </comment>

  <!--
    -- Generally, you will want one <room> node for each walled-off bit of home.
    -- Unlike with Hypertext, "name" should be unique. The "x" and "y" attributes
    -- are the offsets from whatever origin you have defined. The "w" and "l"
    -- attributes are for the width (x-axis) and length (y-axis) of the room.
    -- Height via the "h" attribute is also supported, but is generally not
    -- interesting, at least not in any houses that I can afford.
    -->
  <room name="bedroom" x="12ft" y="0ft" w="12ft" l="10ft">
    <!-- Closets are rooms that are dependent on another room for lighting. -->
    <closet name="bedroom-closet" x="-2ft" y="0ft" w="2ft" l="5ft"></closet>

    <!--
      -- Each IoT device should have its own node. The node's tag-name controls
      -- how the device is controlled (e.g. light vs switch vs motion[detector]).
      -- Whereas the "kind" attribute controls what protocol driver attempts to
      -- drive the device. The "name" attribute should match whatever you've
      -- configured the name as in the vendor's control panel.
      -->
    <light kind="hue" name="bedroom-bed"></light>
    <light kind="hue" name="bedroom-desk0"></light>
    <light kind="hue" name="bedroom-desk1"></light>
    <light kind="hue" name="bedroom-tree0"></light>
    <light kind="hue" name="bedroom-tree1"></light>
    <light kind="hue" name="bedroom-tree2" on_at_night="true"></light>
    <light kind="hue" name="bedroom-ceiling"></light>

    <!-- <motion kind="wemo" name="m-bedroom-south"></motion> -->

    <scene name="sleep" default-activity="sleeping">
      <activity name="sleeping">
        <rule name="0" style="visibility:hidden;">light:not([on_at_night])</rule>
      </activity>
    </scene>
  </room>

  <room name="office" x="0ft" y="0ft" w="10ft" l="13ft">
    <closet name="office-closet" x="10ft" y="5ft" w="2ft" l="5ft"></closet>

    <hue-bridge name="huebridge" ipv4="hue-bridge" username="MasterControlProgram"></hue-bridge>

    <light kind="hue" name="office-ceiling1"></light>
    <light kind="hue" name="office-ceiling2"></light>
    <!--<light kind="hue" name="office-torch"></light>-->

    <!--
    <motion kind="wemo" name="m-office-desk0"></motion>
    <motion kind="wemo" name="m-office-west"></motion>
    <motion kind="wemo" name="m-office-east" context="room[name=office], room[name=hall]"></motion>
    -->
    <motion kind="wemo" name="m-office-desk1" x="3ft" y="6in"></motion>
    <motion kind="wemo" name="m-office-desk2" x="9ft" y="5ft"></motion>
    <motion kind="wemo" name="m-office-south" x="0ft" y="10ft"></motion>
    <motion kind="wemo" name="m-office-east" x="10ft" y="12ft"></motion>

    <switch kind="wemo" name="s-office-desk1" x="3ft" y="1ft6in"></switch>
  </room>

  <room name="hall" x="10ft" y="10ft" w="7ft" l="6ft" noborder>
    <closet name="hall-closet" x="6ft" y="3ft" w="1ft" l="3ft"></closet>

    <light kind="hue" name="hall-ceiling0"></light>
    <light kind="hue" name="hall-ceiling1" off_at_night="true"></light>

    <scene name="sleep" default-activity="sleeping">
      <activity name="sleeping">
        <rule name="0" style="visibility:hidden;">light</rule>
      </activity>
    </scene>
  </room>

  <room name="bathroom" x="17ft" y="10ft" w="7ft" l="6ft">
  </room>

  <room name="kitchen" x="13ft" y="16ft" w="11ft" l="8ft">
    <!--<door facing="north" x="6in" y="0ft" into="hall">-->
      <motion kind="wemo" name="m-kitchen-north" x="3ft6in" y="0in"></motion>
    <!--</door>-->

    <light kind="hue" name="kitchen-sink"></light>
    <light kind="hue" name="kitchen-ceiling0"></light>
    <light kind="hue" name="kitchen-ceiling1"></light>
    <light kind="hue" name="kitchen-ceiling2"></light>
    <light kind="hue" name="kitchen-ceiling3"></light>
    <light kind="hue" name="kitchen-ceiling4"></light>

    <switch kind="wemo" name="s-kitchen-sink" x="11ft" y="4ft10in"></switch>

    <motion kind="wemo" name="m-kitchen-sink" x="11ft" y="1ft4in"></motion>
  </room>

  <room name="utility" x="20ft6in" y="24ft" w="4ft6in" l="8ft6in">
    <light kind="hue" name="utility-ceiling"></light>
    <motion kind="wemo" name="m-utility-north" x="4in" y="1ft6in"></motion>
  </room>

  <room name="livingroom" x="0ft" y="13ft" w="13ft" l="19ft9in">
    <light kind="hue" name="livingroom-couch"></light>
    <light kind="hue" name="livingroom-torch"></light>
    <light kind="hue" name="livingroom-tower0"></light>
    <light kind="hue" name="livingroom-tower1"></light>
    <light kind="hue" name="livingroom-tower2"></light>
    <light kind="hue-livingcolors" name="livingroom-console0"></light>

    <switch kind="wemo" name="s-livingroom-couch" x="1ft6in" y="4ft" context="home" attribute="scene" value="movie"></switch>
    <!-- <motion kind="wemo" name="north"></motion> -->
  </room>

  <room name="diningroom" x="13ft" y="24ft" w="7ft6in" l="8ft6in">
    <light kind="hue" name="diningroom-shelves"></light>
    <light kind="hue" name="diningroom-ceiling"></light>
  </room>

  <alarm name="wakeup" scene="on"></alarm>

  <scene name="on" default-activity="yes">
    <activity name="yes">
      <rule name="0" class="daylight">light</rule>
      <rule name="1" class="off">light[kind=hue-livingcolors]</rule>
    <activity>

    <activity name="no">
      <rule name="0" class="off">light</rule>
      <rule name="0" class="moonlight">light[kind=hue-livingcolors]</rule>
    </activity>
  </scene>

  <scene name="off" default-activity="any">
    <activity name="any">
      <rule name="0" class="off">light</rule>
    </activity>
  </scene>

  <scene name="sleep" default-activity="sleeping">
    <activity name="sleeping">
      <rule name="0" class="moonlight">light</rule>
    </activity>
    <activity name="yes">
      <rule name="0" class="low">light</rule>
    </activity>
  </scene>

  <scene name="movie" default-activity="watching">
    <activity name="watching">
      <rule name="0" class="moonlight">light</rule>
      <rule name="1" class="off">light[kind=hue-livingcolors]</rule>
      <rule name="2" class="off">room[name='diningroom'] light</rule>
      <rule name="3" class="off">room[name='livingroom'] light[name*='tower']</rule>
    </activity>
    <activity name="yes">
      <rule name="0" class="daylight">light</rule>
    </activity>
  </scene>

  <scene name="game-study" default-activity="yes">
    <activity name="yes">
      <rule name="0" class="daylight">light</rule>
      <rule name="1" class="off">light[kind=hue-livingcolors]</rule>
      <rule name="2" class="off">room[name='diningroom'] light</rule>
      <rule name="3" class="off">room[name='livingroom'] light[name*='tower']</rule>
      <rule name="4" class="off">room[name='hall'] light</rule>
    </activity>
  </scene>

  <scene name="low">
    <rule name="0" class="low">light</rule>
  </scene>

  <runtime name="runtime"></runtime>
</home>
</html>

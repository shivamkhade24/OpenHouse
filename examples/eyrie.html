<html>
<head>
  <meta charset="UTF-8"></meta>
  <title>Eyrie</title>
  <style>
    /*
     * Most IoT lights support some sort of hardware dimming. This sets the
     * interval to 1 second by default, for devices that support such animation.
     */
    light {
      animation-duration: 1;
    }

    /* Define classes for light styles we use below. */
    .off {
      /*
       * Visibility 'visible' lights are switched on, whereas 'hidden' lights
       * are switched off.
       */
      visibility: hidden;

      /*
       * OpenHouse supports #rgb, #rrggbb, rgb(u8,u8,u8), as one would expect.
       * It also support more specific modes like mired(N) to set a specific
       * color-temperature on supporting bulbs as well as brightness-hue-
       * saturation, bhs(u8,u16,u8).
       */
      color: bhs(0, 47000, 255);
    }
    .low {
      visibility: visible;
      color: bhs(64, 34495, 232);
    }
    .moonlight {
      visibility: visible;
      color: bhs(0, 47000, 255);
    }
    .daylight {
      visibility: visible;
      color: bhs(255, 34495, 232);
    }
  </style>
</head>

<!-- The top-level layout element of the Home Text Markup Language is the "home". -->
<home name="eyrie" scene="on" w="24ft" l="32ft6in">
  <!-- This comment block describes in a more graphical form the layout elements that follow. -->
  <comment>
    Horizontal: 4 '-' per ft
    Vert: 2 '|' per ft
    Reference is upper-left corner.
    X is left-to-right.
    Y is top-to-bottom.
    Z is floor-to-ceiling.

    ---------------------------------------------------------------------------------------------------+
    |                                        |        .            *                                   |
    |                                        |        .                                                |
    |                                        |        .                                                |
    |                                        |        .                                                |
    |                                        |        .                                                |
    |                                        |        .                                                |
    |                                        |        .                                                |
    |                                        |        .                                                |
    |         Office                         |        .                 Bedroom                        |
    |            10ftx13ft                   |________.                    12ftx10ft                   |
    |                 (+2ft for closet)      .        |                       (+2ft for closet)        |
    |                                        .        |                                                |
    |                                        .        |                                                |
    |                                        .        |                                                |
    |                                        .        |                                                |
    |                                        .        |                                                |
    |                                        .        |                                                |
    |                                        .        |                                                |
    |                                        +________+@@@@@@@@@@--------------------------------------+
    |                                        @                         @                               |
    |                                        @        Hall             @                               |
    |                                        @          7' x 6'        @                               |
    |                                        @                         @                               |
    |@@@@@@-------------------------------------------+          +-----+        Bathroom               |
    @                                                 @          @     |                               |
    @                                                 @          @     |                               |
    @  Entry                                          @          @     |                               |
    @    42" x 42"                                    @          @     |                               |
    @                                                 @          @     |                               |
    +--------------                                   +@@@@@@@@@@+-----+-------------------------------+
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |          Kitchen                               |
    |                                                 |             12'x8'                             |
    |     Living Room                                 |                                                |
    |        13' x 19'9"                              |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 |                                                |
    |                                                 +----------------@@@@@@@@@@@@---+@@@@@@@@@@------+
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                      Dining Room                |   Utility      |
    |                                                         7'6"x8'6"               |     4'6"x8'6"  |
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                                                 |                |
    |                                                                                 |                |
    +-------------------------------------@@@@@@@@@@@@--------------------------------+----------------+
  </comment>

  <!--
    -- A design describes how to configure the lighting (and other output devices) when requested to do so.
    -- The following four designs just apply each class we defined above to all <light>s.
    -->
  <design name="all-on">
    <rule name="0" class="daylight">light</rule>
  </design>

  <design name="all-off">
    <rule name="0" class="off">light</rule>
  </design>

  <design name="moonlight">
    <rule name="0" class="moonlight">light</rule>
  </design>

  <!-- This rule turns on the lights, but turns off philip's "livingcolors" series lamps. The
       livingcolors series of lamps do not have a white-phosphor diffuser, allowing them to
       achieve more vivid saturated colors. They never look quite white, however, so they tend to
       clash with "normal" lighting. -->
  <design name="normal-on">
    <!-- Rules are read in lexicographical order by name and only applied after concatenating all
         effects; thus, the following rules will not turn on the livingcolor lights before turning them
         back off. -->
    <rule name="0" class="daylight">light</rule>
    <rule name="1" class="off">light[kind=livingcolors]</rule>
  </design>

  <!-- This rule turns off the lights, but leaves "livingcolors" lights on at a low glimmer, giving our
       living spaces a gentle moonlight glow at night. -->
  <design name="nighttime-off">
    <rule name="0" class="off">light</rule>
    <rule name="1" class="moonlight">light[kind=livingcolors]</rule>
  </design>

  <!-- As with normal-on, but setting the lights to half-intensity. Useful when walking about at night. -->
  <design name="normal-low">
    <rule name="0" class="low">light</rule>
    <rule name="1" class="off">light[kind=livingcolors]</rule>
  </design>

  <!--
    -- A scene tells us what designs to use on the lights by default and when motion and switches are
    -- activated in a room. For example, in the evening, you probably want all lights to come on when you
    -- enter a room, but after going to bed, maybe you only want the lights to come on at half intensity,
    -- or only some lights.
    -->

  <!-- During the daytime, we want lights to normally be off, but turn on when we enter a room. My house is
       generally well lit, however, so we only need the lights on at half intensity. To do this we add an
       activity node "yes" and set its design to "low" and an activity for "no" and set it to have a design
       of "off". Unfortunately, I don't have motion detectors in all rooms yet, so in those cases we need
       to default to low. In the few rooms without many windows, we can add per-room scene overrides to fix
       this to turn on the lights all the way in rooms that need it. -->
  <scene name="daytime" default-design="normal-low">
    <activity name="yes" design="normal-low"></activity>
    <activity name="no" design="off"></activity>
  </scene>

  <!-- In the evening, it is dark, so change off to low and low to on. -->
  <scene name="evening" default-design="normal-on">
    <activity name="yes" design="normal-on"></activity>
    <activity name="no" design="normal-low"></activity>
  </scene>

  <!-- When sleeping, we want things to be mostly dark, but turn up the lights on motion so we don't
       stumble into things. My bedroom doesn't have motion detectors, but if it did I would need to
       add a <scene> node in the bedroom to keep the lights off when activity is "yes". -->
  <scene name="sleep" default-design="nighttime-off">
    <activity name="yes" design="normal-low"></activity>
    <activity name="no" design="nighttime-off"></activity>
  </scene>

  <!-- When using the screen, try to minimize all ambient lighting. -->
  <scene name="movie" default-design="moonlight">
    <activity name="yes" design="normal-low"></activity>
    <activity name="no" design="off"></activity>
  </scene>

  <!--
    -- Rooms define sub-areas of a home. They can be independently configured with
    -- overrides to the current and default light designs.
    --
    -- Generally, you will want one <room> node for each walled-off bit of home.
    -- Unlike with Hypertext, "name" should be unique. The "x" and "y" attributes
    -- are the offsets from whatever origin you have defined. The "w" and "l"
    -- attributes are for the width (x-axis) and length (y-axis) of the room.
    -- Height via the "h" attribute is also supported, but is generally not
    -- interesting, at least not in any houses that I can afford.
    -->
  <room name="bedroom" x="12ft" y="0ft" w="12ft" l="10ft">
    <!-- Closets are rooms that are dependent on another room for lighting. -->
    <closet name="bedroom-closet" x="-2ft" y="0ft" w="2ft" l="5ft"></closet>

    <!--
      -- Each IoT device should have its own node. The node's tag-name controls
      -- how the device is controlled (e.g. light vs switch vs motion[detector]).
      -- Whereas the "kind" attribute controls what protocol driver attempts to
      -- drive the device. The "name" attribute should match whatever you've
      -- configured the name as in the vendor's control panel.
      -->
    <light kind="hue" name="bedroom-bookshelf0" x="10ft" y="1ft"></light>
    <light kind="hue" name="bedroom-bookshelf1" x="4ft" y="8ft"></light>
    <light kind="hue" name="bedroom-dresser" x="10ft" y="2ft"></light>
    <light kind="hue" name="bedroom-tree0" x="1ft" y="2ft"></light>
    <light kind="hue" name="bedroom-tree1" x="1ft" y="1ft"></light>
    <light kind="hue" name="bedroom-tree2" x="2ft" y="1ft"></light>
    <light kind="hue" name="bedroom-ceiling" x="6ft" y="6ft"></light>

    <!-- The bedroom has lots of lights, so override the moonlight design to be
         be less overwhelming by shutting off all lights that are not tagged with
         the on_at_night attribute. -->
    <design name="moonlight">
      <rule name="0" style="visibility:hidden;">light:not([on_at_night])</rule>
    </design>

    <!-- The bedroom is also fairly dark, so update the daytime scene to turn
         the lights on fully. -->
    <scene name="daytime">
      <activity name="yes" design="normal-on"></activity>
    </scene>
  </room>

  <room name="office" x="0ft" y="0ft" w="10ft" l="13ft">
    <closet name="office-closet" x="10ft" y="5ft" w="2ft" l="5ft"></closet>

    <hue-bridge name="huebridge" ipv4="hue-bridge" username="MasterControlProgram"></hue-bridge>

    <light kind="hue" name="office-ceiling1" x="5ft" y="6ft"></light>
    <light kind="hue" name="office-ceiling2" x="4ft" y="7ft"></light>
    <!--<light kind="hue" name="office-torch"></light>-->

    <!--
    <motion kind="wemo" name="m-office-desk0"></motion>
    <motion kind="wemo" name="m-office-west"></motion>
    <motion kind="wemo" name="m-office-east" context="room[name=office], room[name=hall]"></motion>
    -->
    <motion kind="wemo" name="m-office-desk1" x="3ft" y="6in"></motion>
    <motion kind="wemo" name="m-office-desk2" x="9ft" y="5ft"></motion>
    <motion kind="wemo" name="m-office-south" x="0ft" y="10ft"></motion>
    <motion kind="wemo" name="m-office-east" x="10ft" y="12ft"></motion>

    <switch kind="wemo" name="s-office-desk1" x="3ft" y="1ft6in"></switch>
  </room>

  <room name="hall" x="10ft" y="10ft" w="7ft" l="6ft" noborder>
    <closet name="hall-closet" x="6ft" y="3ft" w="1ft" l="3ft"></closet>

    <light kind="hue" name="hall-ceiling0" x="4ft" y="2ft"></light>
    <light kind="hue" name="hall-ceiling1" x="5ft" y="3ft"></light>

    <!-- The hall is visible from the bedroom, so needs the same treatment. -->
    <design name="moonlight">
      <rule name="0" style="visibility:hidden;">light:not([on_at_night])</rule>
    </design>
    <scene name="daytime">
      <activity name="yes" design="normal-on"></activity>
    </scene>
  </room>

  <room name="bathroom" x="17ft" y="10ft" w="7ft" l="6ft">
  </room>

  <room name="kitchen" x="13ft" y="16ft" w="11ft" l="8ft">
    <!--<door facing="north" x="6in" y="0ft" into="hall">-->
      <motion kind="wemo" name="m-kitchen-north" x="3ft6in" y="0in"></motion>
    <!--</door>-->

    <light kind="hue" name="kitchen-sink" x="9ft" y="1ft"></light>
    <light kind="hue" name="kitchen-ceiling0" x="2ft" y="6ft"></light>
    <light kind="hue" name="kitchen-ceiling1" x="3ft" y="5ft"></light>
    <light kind="hue" name="kitchen-ceiling2" x="4ft" y="4ft"></light>
    <light kind="hue" name="kitchen-ceiling3" x="5ft" y="3ft"></light>
    <light kind="hue" name="kitchen-ceiling4" x="6ft" y="2ft"></light>

    <switch kind="wemo" name="s-kitchen-sink" x="11ft" y="4ft10in"></switch>

    <motion kind="wemo" name="m-kitchen-sink" x="11ft" y="1ft4in"></motion>
  </room>

  <room name="utility" x="20ft6in" y="24ft" w="4ft6in" l="8ft6in">
    <light kind="hue" name="utility-ceiling" x="2ft" y="4ft"></light>
    <motion kind="wemo" name="m-utility-north" x="4in" y="1ft6in"></motion>
  </room>

  <room name="livingroom" x="0ft" y="13ft" w="13ft" l="19ft9in">
    <light kind="hue" name="livingroom-couch" x="1ft" y="6ft"></light>
    <light kind="hue" name="livingroom-torch" x="1ft" y="10ft"></light>
    <light kind="hue" name="livingroom-tower0" x="10ft" y="3ft"></light>
    <light kind="hue" name="livingroom-tower1" x="10ft" y="2ft"></light>
    <light kind="hue" name="livingroom-tower2" x="10ft" y="1ft"></light>
    <light kind="hue-livingcolors" name="livingroom-console0" x="12ft" y="8ft"></light>

    <switch kind="wemo" name="s-livingroom-couch" x="1ft6in" y="4ft" context="home" attribute="scene" value="movie"></switch>
    <!-- <motion kind="wemo" name="north"></motion> -->
  </room>

  <room name="diningroom" x="13ft" y="24ft" w="7ft6in" l="8ft6in">
    <light kind="hue" name="diningroom-shelves" x="6ft" y="7ft"></light>
    <light kind="hue" name="diningroom-ceiling" x="3ft" y="4ft"></light>
  </room>

  <alarm name="daytime" hour="6" minute="45" scene="daytime"></alarm>
  <alarm name="evening" hour="17" minute="0" scene="evening"></alarm>
  <alarm name="sleep" hour="22" minute="0" scene="sleep"></alarm>

  <runtime name="runtime"></runtime>
</home>
</html>
